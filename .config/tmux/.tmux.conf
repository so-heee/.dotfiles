##########################################################################
# 基本設定
##########################################################################

# tmux起動時のシェルをzshにする
set -g default-shell /bin/zsh
# tmuxを256色表示できるようにする
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',xterm-256color:Tc'
# prefixキーをC-qに変更
set -g prefix C-q
# C-bのキーバインドを解除
unbind C-b
# ESCの反応を高速化
set -s escape-time 0
# 番号基準値を変更
set -g base-index 1
# 履歴バッファを拡大
set -g history-limit 50000
# フォーカスイベントを有効化（Neovimとの相性改善）
set -g focus-events on
# aggressive-resize：ペインごとに正しいサイズを維持
setw -g aggressive-resize on
# ステータスバーを上部に表示
set -g status-position top

##########################################################################
# パフォーマンス・実用系設定
##########################################################################

# tmux メッセージの表示時間を 750 ミリ秒から 4 秒に延長
set -g display-time 4000
# 「status-left」と「status-right」の更新頻度を15秒から1秒に変更
set -g status-interval 1
# コピー時のシステムクリップボード連携（WezTerm + pbcopy対応）
if-shell -b 'true' 'set-option -s set-clipboard on'

##########################################################################
# マウス設定（WezTermとの競合を防ぐ）
##########################################################################

set -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

##########################################################################
# コピーモード設定（vim風）
##########################################################################

setw -g mode-keys vi
bind-key v copy-mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

##########################################################################
# ステータスライン
##########################################################################

# 背景はWezTermのテーマに馴染ませる（透過やGPU描画を阻害しない）
set -g status-bg "black"
set -g status-left ""
# ウィンドウ表示設定
set -g window-status-format "#[fg=black,bg=gray] #I #[fg=white,bg=black] #W "
set -g window-status-current-format "#[fg=black,bg=cyan] #I #[fg=white,bg=black] #W "
# ステータス左／右
set -g status-right '#[fg=black,bg=magenta] 󰴽 #[fg=white,bg=black] #S #[fg=black,bg=blue]  #[fg=white,bg=black] %Y-%m-%d (%a) %H:%M:%S'

##########################################################################
# プラグイン
##########################################################################

# プラグインマネージャー
set -g @plugin 'tmux-plugins/tpm'
# セッションの保存・復元ができるプラグイン
set -g @plugin 'tmux-plugins/tmux-resurrect'
# Tmux Resurrectをサポートするプラグインで自動で保存／復元可能
set -g @plugin 'tmux-plugins/tmux-continuum'
# ペイン制御
set -g @plugin 'tmux-plugins/tmux-pain-control'

run '~/.tmux/plugins/tpm/tpm'
